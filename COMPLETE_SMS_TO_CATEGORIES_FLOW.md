# üîÑ COMPLETE FLOW: SMS ‚Üí CATEGORIZATION ‚Üí STORAGE ‚Üí DISPLAY

## üìã **TABLE OF CONTENTS**

1. [SMS Reception](#1-sms-reception)
2. [Transaction Extraction](#2-transaction-extraction)
3. [Auto-Categorization Process](#3-auto-categorization-process)
4. [Database Storage](#4-database-storage)
5. [Categories Fragment Query](#5-categories-fragment-query)
6. [UI Display](#6-ui-display)
7. [Complete Flow Diagram](#7-complete-flow-diagram)

---

## 1Ô∏è‚É£ **SMS RECEPTION**

### **Entry Point: TransactionSMSReceiver.kt**

```kotlin
// Location: app/src/main/java/.../utils/TransactionSMSReceiver.kt
class TransactionSMSReceiver : BroadcastReceiver() {
    
    override fun onReceive(context: Context?, intent: Intent?) {
        // Triggered when SMS arrives
        if (intent?.action == "android.provider.Telephony.SMS_RECEIVED") {
            
            // Extract SMS data
            val messageBody = smsMessage?.messageBody  // "Rs.500 debited at Amazon..."
            val sender = smsMessage?.originatingAddress  // "HDFCBK"
            
            // Step 1: Check if this is a transaction SMS
            if (isTransactionSMS(messageBody, sender)) {
                Log.d("TransactionSMS", "üîî Detected transaction SMS from $sender")
                
                // Step 2: Process in background (even if app is closed)
                val pendingResult = goAsync()
                CoroutineScope(Dispatchers.IO).launch {
                    processTransactionSMS(context, messageBody, sender)
                    pendingResult.finish()
                }
            }
        }
    }
}
```

### **SMS Validation:**

```kotlin
private fun isTransactionSMS(body: String, sender: String): Boolean {
    val bankSenders = BankConstants.BANK_SENDERS  // 80+ banks
    val transactionKeywords = BankConstants.TRANSACTION_KEYWORDS
    
    val isFromBank = bankSenders.any { sender.uppercase().contains(it) }
    val hasTransactionKeyword = transactionKeywords.any { body.lowercase().contains(it) }
    val hasAmountPattern = body.matches(Regex(".*(?:‚Çπ|rs\\.?|inr)\\s*[0-9,]+.*"))
    
    // Must be: (from bank OR has keywords) AND has amount
    return (isFromBank || hasTransactionKeyword) && hasAmountPattern
}
```

---

## 2Ô∏è‚É£ **TRANSACTION EXTRACTION**

### **Engine: TransactionCategorizationEngine.kt**

```kotlin
// Location: app/src/main/java/.../engine/TransactionCategorizationEngine.kt

fun extractTransactionDetails(smsBody: String): TransactionDetails {
    // Extract amount
    val amount = extractAmount(smsBody)  // ‚Çπ500 ‚Üí 500.0
    
    // Extract merchant
    val merchant = extractMerchant(smsBody)  // "at Amazon" ‚Üí "Amazon"
    
    // Determine type
    val type = determineTransactionType(smsBody)  // DEBIT/CREDIT/TRANSFER
    
    return TransactionDetails(
        amount = amount,
        merchant = merchant,
        type = type,
        description = "Payment to $merchant"
    )
}
```

### **Amount Extraction:**

```kotlin
private fun extractAmount(smsBody: String): Double {
    // Regex: (?:rs\.?|inr|‚Çπ)\s*(\d+(?:,\d{3})*(?:\.\d{1,2})?)
    val amountPattern = Pattern.compile(
        "(?:(?:rs\\.?|inr|‚Çπ)\\s*|(?:debited|credited)\\s+by\\s+)(\\d+(?:,\\d{3})*(?:\\.\\d{1,2})?)"
    )
    
    val matcher = amountPattern.matcher(smsBody)
    if (matcher.find()) {
        val amountStr = matcher.group(1)?.replace(",", "") ?: "0"
        return amountStr.toDoubleOrNull() ?: 0.0
    }
    return 0.0
}

// Examples:
// "Rs.500.00" ‚Üí 500.0
// "debited by 1200" ‚Üí 1200.0
// "‚Çπ1,500" ‚Üí 1500.0
```

### **Merchant Extraction:**

```kotlin
private fun extractMerchant(smsBody: String): String {
    // Regex: (?:at|from|to|trf\s+to)\s+([a-zA-Z0-9\s&.-]+?)
    val merchantPattern = Pattern.compile(
        "(?:at|from|to|trf\\s+to|transferred\\s+to|towards)\\s+([a-zA-Z0-9\\s&.-]+?)(?:\\s+(?:on|from|refno|umn|thru|through)|\\.|$)"
    )
    
    val matcher = merchantPattern.matcher(smsBody)
    if (matcher.find()) {
        return matcher.group(1)?.trim() ?: "Unknown"
    }
    
    // Fallback: check for common merchants
    val commonMerchants = listOf("amazon", "flipkart", "zomato", "swiggy", "uber", "ola")
    for (merchant in commonMerchants) {
        if (smsBody.lowercase().contains(merchant)) {
            return merchant.capitalize()
        }
    }
    
    return "Unknown Merchant"
}

// Examples:
// "debited at AMAZON INDIA" ‚Üí "AMAZON INDIA"
// "paid to ZOMATO" ‚Üí "ZOMATO"
// "from mr shivam dinesh atr" ‚Üí "mr shivam dinesh atr"
```

### **Transaction Type:**

```kotlin
private fun determineTransactionType(smsBody: String): TransactionType {
    val lowerSms = smsBody.lowercase()
    return when {
        lowerSms.contains("debited") || lowerSms.contains("spent") || 
        lowerSms.contains("paid") 
            ‚Üí TransactionType.DEBIT
        
        lowerSms.contains("credited") || lowerSms.contains("received") || 
        lowerSms.contains("refund") 
            ‚Üí TransactionType.CREDIT
        
        lowerSms.contains("transfer") 
            ‚Üí TransactionType.TRANSFER
        
        else ‚Üí TransactionType.DEBIT  // Default
    }
}
```

---

## 3Ô∏è‚É£ **AUTO-CATEGORIZATION PROCESS**

### **Categorizer: MerchantCategorizer.kt**

```kotlin
// Location: app/src/main/java/.../utils/MerchantCategorizer.kt

object MerchantCategorizer {
    
    // Category Keywords (20-30 per category)
    private val categoryKeywords = mapOf(
        "food" to listOf(
            "zomato", "swiggy", "ubereats", "dominos", "pizzahut", 
            "mcdonalds", "kfc", "burgerking", "starbucks", ...
        ),
        "transport" to listOf(
            "uber", "ola", "rapido", "indianoil", "bpcl", "shell", 
            "fastag", "makemytrip", ...
        ),
        "shopping" to listOf(
            "amazon", "flipkart", "myntra", "ajio", "meesho", 
            "nykaa", "croma", ...
        ),
        "grocery" to listOf(
            "bigbasket", "blinkit", "zepto", "dunzo", "dmart", 
            "jiomart", ...
        ),
        // ... 10 categories total
    )
    
    fun categorizeTransaction(merchant: String, smsBody: String? = null): String {
        val merchantLower = merchant.lowercase().trim()
        val smsBodyLower = smsBody?.lowercase()?.trim() ?: ""
        
        Log.d(TAG, "üîç ===== CATEGORIZING =====")
        Log.d(TAG, "üìù Merchant: '$merchant'")
        Log.d(TAG, "üìù SMS Body: ${smsBody?.take(100)}...")
        
        // Try to match with category keywords
        for ((category, keywords) in categoryKeywords) {
            for (keyword in keywords) {
                val keywordLower = keyword.lowercase().trim()
                
                // Skip very short keywords
                if (keywordLower.length < 3) continue
                
                // Method 1: Check first 3-4 character match
                if (merchantLower.length >= 3) {
                    val merchantFirst4 = merchantLower.take(4)
                    val keywordFirst4 = keywordLower.take(4)
                    
                    if (merchantFirst4 == keywordFirst4) {
                        Log.d(TAG, "‚úÖ Match: '$merchant' ‚Üí $category")
                        return category
                    }
                }
                
                // Method 2: Full keyword match
                if (merchantLower.contains(keywordLower) || 
                    smsBodyLower.contains(keywordLower)) {
                    Log.d(TAG, "‚úÖ Full match: '$keyword' ‚Üí $category")
                    return category
                }
            }
        }
        
        // No match found
        Log.d(TAG, "‚ö†Ô∏è No match ‚Üí others")
        return "others"
    }
}
```

### **Categorization Examples:**

```
Input: merchant = "Amazon India"
Process:
  - merchantLower = "amazon india"
  - Loop through categories
  - Check "shopping" keywords
  - Find "amazon" in keywords
  - "amazon india".contains("amazon") = TRUE
Output: "shopping"

Input: merchant = "Zomato"
Process:
  - merchantLower = "zomato"
  - Loop through categories
  - Check "food" keywords
  - Find "zomato" in keywords
  - First 4 chars: "zoma" == "zoma" = TRUE
Output: "food"

Input: merchant = "mr shivam dinesh atr"
Process:
  - merchantLower = "mr shivam dinesh atr"
  - Loop through all categories
  - No keyword matches
  - Check SMS body for keywords
  - If SMS contains "received a payment" and type = CREDIT
    ‚Üí Might be "salary"
Output: "salary" or "others"
```

---

## 4Ô∏è‚É£ **DATABASE STORAGE**

### **Step 1: Create Transaction Object**

```kotlin
// In SMSManager.processAllSMS() or TransactionSMSReceiver

// After extraction and categorization:
val details = engine.extractTransactionDetails(smsBody)
// details.amount = 500.0
// details.merchant = "Amazon India"
// details.type = DEBIT

val categoryId = MerchantCategorizer.categorizeTransaction(
    details.merchant, 
    smsBody
)
// categoryId = "shopping"

val transaction = Transaction(
    id = UUID.randomUUID().toString(),  // "123e4567-e89b-12d3-a456-426614174000"
    amount = details.amount,             // 500.0
    type = details.type,                 // TransactionType.DEBIT
    merchant = details.merchant,         // "Amazon India"
    categoryId = categoryId,             // "shopping"
    confidence = 85.0f,                  // Auto-categorization confidence
    date = sms.timestamp,                // 1696512000000 (timestamp)
    description = details.description,   // "Payment to Amazon India"
    smsBody = smsBody,                   // Original SMS (for duplicate check)
    isManuallySet = false,               // Auto-categorized, not manual
    bankName = "HDFC Bank"              // Extracted from sender
)
```

### **Step 2: Insert into Database**

```kotlin
// Room Database insertion
database.transactionDao().insertTransaction(transaction)

Log.d("SMSManager", "‚úÖ Created transaction: ‚Çπ${details.amount} at ${details.merchant} ‚Üí Category: $categoryId")
```

### **Database Table Structure:**

```sql
CREATE TABLE transactions (
    id TEXT PRIMARY KEY,                    -- "123e4567-..."
    amount REAL,                            -- 500.0
    description TEXT,                       -- "Payment to Amazon India"
    merchant TEXT,                          -- "Amazon India"
    categoryId TEXT,                        -- "shopping" (FK ‚Üí transaction_categories)
    type TEXT,                              -- "DEBIT"
    date INTEGER,                           -- 1696512000000
    smsId TEXT,                             -- null (for SMS reference)
    isProcessed INTEGER,                    -- 0 (boolean)
    createdAt INTEGER,                      -- 1696512000000
    updatedAt INTEGER,                      -- 1696512000000
    confidence REAL,                        -- 85.0
    smsBody TEXT,                           -- "Rs.500 debited at Amazon..."
    isManuallySet INTEGER,                  -- 0 (false = auto-categorized)
    bankName TEXT,                          -- "HDFC Bank"
    
    FOREIGN KEY (categoryId) REFERENCES transaction_categories(id)
        ON DELETE SET NULL 
        ON UPDATE CASCADE
);

CREATE INDEX idx_categoryId ON transactions(categoryId);
```

### **Multiple Transactions in Database:**

```
transactions table:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id       ‚îÇ amount ‚îÇ merchant    ‚îÇ categoryId‚îÇ type     ‚îÇ date ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ txn-001  ‚îÇ 500.0  ‚îÇ Amazon      ‚îÇ shopping  ‚îÇ DEBIT    ‚îÇ Oct 5‚îÇ
‚îÇ txn-002  ‚îÇ 1200.0 ‚îÇ Zomato      ‚îÇ food      ‚îÇ DEBIT    ‚îÇ Oct 6‚îÇ
‚îÇ txn-003  ‚îÇ 25000.0‚îÇ Salary Cred ‚îÇ salary    ‚îÇ CREDIT   ‚îÇ Oct 1‚îÇ
‚îÇ txn-004  ‚îÇ 350.0  ‚îÇ Uber        ‚îÇ transport ‚îÇ DEBIT    ‚îÇ Oct 7‚îÇ
‚îÇ txn-005  ‚îÇ 800.0  ‚îÇ DMart       ‚îÇ grocery   ‚îÇ DEBIT    ‚îÇ Oct 8‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 5Ô∏è‚É£ **CATEGORIES FRAGMENT QUERY**

### **Fragment: CategoriesFragment.kt**

```kotlin
// Location: app/src/main/java/.../ui/categories/CategoriesFragment.kt

private fun loadCategoryData() {
    lifecycleScope.launch {
        Log.d("CategoriesFragment", "üîÑ Loading category data...")
        
        // Step 1: Calculate month range (e.g., Oct 1 - Oct 31, 2025)
        val calendar = Calendar.getInstance()
        calendar.set(Calendar.YEAR, selectedYear)        // 2025
        calendar.set(Calendar.MONTH, selectedMonth)      // 9 (October, 0-based)
        calendar.set(Calendar.DAY_OF_MONTH, 1)
        calendar.set(Calendar.HOUR_OF_DAY, 0)
        calendar.set(Calendar.MINUTE, 0)
        calendar.set(Calendar.SECOND, 0)
        calendar.set(Calendar.MILLISECOND, 0)
        val startOfMonth = calendar.timeInMillis         // 1696118400000
        
        calendar.add(Calendar.MONTH, 1)
        calendar.add(Calendar.MILLISECOND, -1)
        val endOfMonth = calendar.timeInMillis           // 1698796799999
        
        Log.d("CategoriesFragment", "üìÖ Querying Oct 2025 from $startOfMonth to $endOfMonth")
        
        // Step 2: Query database for category spending
        val categorySpending = transactionRepository
            .getCurrentMonthCategorySpending(startOfMonth, endOfMonth)
        
        Log.d("CategoriesFragment", "üìä Found ${categorySpending.size} categories with spending")
        
        // Log each category
        categorySpending.forEach { spending ‚Üí
            val categoryName = TransactionCategory.getDefaultCategories()
                .find { it.id == spending.categoryId }?.name ?: "Unknown"
            Log.d("CategoriesFragment", "   üí∞ ${spending.categoryId} ('$categoryName') ‚Üí ‚Çπ${spending.totalAmount}")
        }
        
        // Step 3: Update UI
        if (categorySpending.isNotEmpty()) {
            updatePieChart(categorySpending)
            updateCategoryList(categorySpending)
            updateTotalSpending(categorySpending)
            showDataViews()
        } else {
            showEmptyState()
        }
    }
}
```

### **Database Query (DAO):**

```kotlin
// Location: app/src/main/java/.../data/local/dao/TransactionDao.kt

@Query("""
    SELECT 
        categoryId, 
        SUM(amount) as totalAmount 
    FROM transactions 
    WHERE type = 'DEBIT'                    -- Only expenses (not income)
      AND categoryId IS NOT NULL            -- Must have a category
      AND date >= :startOfMonth             -- Oct 1, 2025
      AND date <= :endOfMonth               -- Oct 31, 2025
    GROUP BY categoryId                     -- Group by category
    HAVING SUM(amount) > 0                  -- Only categories with spending
    ORDER BY totalAmount DESC               -- Highest spending first
""")
suspend fun getCurrentMonthCategorySpending(
    startOfMonth: Long, 
    endOfMonth: Long
): List<CategorySpending>
```

### **Query Execution Example:**

```sql
-- Input:
startOfMonth = 1696118400000  -- Oct 1, 2025, 00:00:00
endOfMonth = 1698796799999    -- Oct 31, 2025, 23:59:59

-- Query execution:
SELECT categoryId, SUM(amount) as totalAmount 
FROM transactions 
WHERE type = 'DEBIT' 
  AND categoryId IS NOT NULL 
  AND date >= 1696118400000 
  AND date <= 1698796799999
GROUP BY categoryId 
HAVING SUM(amount) > 0
ORDER BY totalAmount DESC;

-- Result:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ categoryId‚îÇ totalAmount ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ food      ‚îÇ 1200.0      ‚îÇ  -- Zomato
‚îÇ grocery   ‚îÇ 800.0       ‚îÇ  -- DMart
‚îÇ shopping  ‚îÇ 500.0       ‚îÇ  -- Amazon
‚îÇ transport ‚îÇ 350.0       ‚îÇ  -- Uber
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Result Object: CategorySpending**

```kotlin
// Location: app/src/main/java/.../model/CategorySpending.kt

data class CategorySpending(
    val categoryId: String,      // "food"
    val totalAmount: Double      // 1200.0
)

// List returned from query:
listOf(
    CategorySpending("food", 1200.0),
    CategorySpending("grocery", 800.0),
    CategorySpending("shopping", 500.0),
    CategorySpending("transport", 350.0)
)
```

---

## 6Ô∏è‚É£ **UI DISPLAY**

### **Step 1: Update Pie Chart**

```kotlin
private fun updatePieChart(categorySpending: List<CategorySpending>) {
    val entries = mutableListOf<PieEntry>()
    val colors = mutableListOf<Int>()
    
    categorySpending.forEach { spending ‚Üí
        // Get category details from default categories
        val category = TransactionCategory.getDefaultCategories()
            .find { it.id == spending.categoryId }
        
        // Category name for display
        val categoryName = category?.name ?: "Unknown"  // "Food & Dining"
        
        // Add pie entry
        entries.add(PieEntry(spending.totalAmount.toFloat(), categoryName))
        // PieEntry(1200.0f, "Food & Dining")
        
        // Get category color
        val color = try {
            Color.parseColor(category?.color ?: "#6750A4")  // "#FF6B35" (orange)
        } catch (e: Exception) {
            Color.parseColor("#6750A4")  // Default purple
        }
        colors.add(color)
    }
    
    // Create dataset
    val dataSet = PieDataSet(entries, "Categories").apply {
        setColors(colors)
        sliceSpace = 3f              // Space between slices
        selectionShift = 5f          // Shift when tapped
        valueTextSize = 0f           // Hide values on slices
    }
    
    // Create pie data
    val data = PieData(dataSet).apply {
        setValueFormatter(PercentFormatter())
        setValueTextColor(Color.TRANSPARENT)  // Hide text
    }
    
    // Update chart
    binding.pieChart.data = data
    binding.pieChart.invalidate()  // Refresh
}
```

**Pie Chart Display:**
```
        ‚ï±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï≤
      ‚ï±  üçî Food   ‚ï≤
     ‚îÇ   42.1%      ‚îÇ
     ‚îÇ              ‚îÇ
    ‚ï± üõí Grocery    ‚ï≤
   ‚îÇ    28.1%       ‚îÇ
    ‚ï≤               ‚ï±
     ‚îÇ üõçÔ∏è Shopping ‚îÇ
     ‚îÇ   17.5%     ‚îÇ
      ‚ï≤ üöó Trans  ‚ï±
        ‚ï≤ 12.3% ‚ï±
          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  Center: Spends
          ‚Çπ2,850
```

### **Step 2: Update Category List**

```kotlin
private fun updateCategoryList(categorySpending: List<CategorySpending>) {
    // Submit to adapter
    categorySpendingAdapter.submitList(categorySpending)
}
```

**Adapter Binding:**

```kotlin
// Location: app/src/main/java/.../ui/categories/adapter/CategorySpendingAdapter.kt

inner class CategorySpendingViewHolder(binding: ItemCategorySpendingBinding) {
    
    fun bind(categorySpending: CategorySpending) {
        // categorySpending.categoryId = "food"
        // categorySpending.totalAmount = 1200.0
        
        // Get category details
        val category = TransactionCategory.getDefaultCategories()
            .find { it.id == categorySpending.categoryId }
        
        // Set category name
        tvCategoryName.text = category?.name ?: "Unknown"
        // "Food & Dining"
        
        // Set amount
        tvAmount.text = "‚Çπ${String.format("%.0f", categorySpending.totalAmount)}"
        // "‚Çπ1,200"
        
        // Set transaction count (placeholder for now)
        tvTransactionCount.text = "1 Spend"
        
        // Set category icon
        if (category != null) {
            ivCategoryIcon.setImageResource(category.icon)  // R.drawable.ic_menu_eat
            
            // Set icon color
            val color = Color.parseColor(category.color)  // #FF6B35 (orange)
            cardIcon.setCardBackgroundColor(color)
            ivCategoryIcon.setColorFilter(Color.WHITE)
        }
    }
}
```

**List Display:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [üçî] Food & Dining       ‚Çπ1,200    ‚îÇ
‚îÇ      1 Spend          Set budget > ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [üõí] Grocery             ‚Çπ800      ‚îÇ
‚îÇ      1 Spend          Set budget > ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [üõçÔ∏è] Shopping            ‚Çπ500      ‚îÇ
‚îÇ      1 Spend          Set budget > ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [üöó] Transportation      ‚Çπ350      ‚îÇ
‚îÇ      1 Spend          Set budget > ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Step 3: Update Total Spending**

```kotlin
private fun updateTotalSpending(categorySpending: List<CategorySpending>) {
    val total = categorySpending.sumOf { it.totalAmount }
    // 1200 + 800 + 500 + 350 = 2850.0
    
    binding.tvTotalSpending.text = "‚Çπ${String.format("%.0f", total)}"
    // "‚Çπ2,850"
}
```

---

## 7Ô∏è‚É£ **COMPLETE FLOW DIAGRAM**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    üì± SMS ARRIVES                               ‚îÇ
‚îÇ  "Rs.500 debited at Amazon India on 05-Oct-25"                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              üì• STEP 1: SMS RECEPTION                           ‚îÇ
‚îÇ  TransactionSMSReceiver.onReceive()                             ‚îÇ
‚îÇ    ‚Ä¢ Sender: "HDFCBK"                                           ‚îÇ
‚îÇ    ‚Ä¢ Body: "Rs.500 debited at Amazon India..."                 ‚îÇ
‚îÇ    ‚Ä¢ isTransactionSMS(): ‚úÖ TRUE                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           üîç STEP 2: TRANSACTION EXTRACTION                     ‚îÇ
‚îÇ  TransactionCategorizationEngine.extractTransactionDetails()    ‚îÇ
‚îÇ    ‚Ä¢ extractAmount(): "Rs.500" ‚Üí 500.0                         ‚îÇ
‚îÇ    ‚Ä¢ extractMerchant(): "at Amazon India" ‚Üí "Amazon India"     ‚îÇ
‚îÇ    ‚Ä¢ determineType(): "debited" ‚Üí TransactionType.DEBIT        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Result: TransactionDetails(                                    ‚îÇ
‚îÇ    amount = 500.0,                                              ‚îÇ
‚îÇ    merchant = "Amazon India",                                   ‚îÇ
‚îÇ    type = DEBIT,                                                ‚îÇ
‚îÇ    description = "Payment to Amazon India"                      ‚îÇ
‚îÇ  )                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            üè∑Ô∏è STEP 3: AUTO-CATEGORIZATION                      ‚îÇ
‚îÇ  MerchantCategorizer.categorizeTransaction()                    ‚îÇ
‚îÇ    Input: merchant = "Amazon India"                             ‚îÇ
‚îÇ           smsBody = "Rs.500 debited at Amazon India..."         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ    Process:                                                     ‚îÇ
‚îÇ      1. merchantLower = "amazon india"                          ‚îÇ
‚îÇ      2. Loop through categories:                                ‚îÇ
‚îÇ         - food: no match                                        ‚îÇ
‚îÇ         - grocery: no match                                     ‚îÇ
‚îÇ         - transport: no match                                   ‚îÇ
‚îÇ         - shopping: checking...                                 ‚îÇ
‚îÇ           ‚Ä¢ keywords: ["amazon", "flipkart", ...]               ‚îÇ
‚îÇ           ‚Ä¢ "amazon india".contains("amazon") = ‚úÖ TRUE         ‚îÇ
‚îÇ      3. MATCH FOUND!                                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ    Output: "shopping"                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              üíæ STEP 4: DATABASE STORAGE                        ‚îÇ
‚îÇ  Transaction object created:                                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ id: "txn-001"                                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ amount: 500.0                                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ merchant: "Amazon India"                                  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ categoryId: "shopping"    ‚Üê STORED CATEGORY               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ type: DEBIT                                               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ date: 1696512000000  (Oct 5, 2025)                       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ smsBody: "Rs.500 debited..."                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ isManuallySet: false  (auto-categorized)                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ bankName: "HDFC Bank"                                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  database.transactionDao().insertTransaction(transaction)      ‚îÇ
‚îÇ    ‚Üì                                                            ‚îÇ
‚îÇ  Inserted into `transactions` table with categoryId reference  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                    [DATABASE]
                         ‚îÇ
transactions table       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id        ‚îÇ amount ‚îÇ merchant   ‚îÇ categoryId‚îÇ type ‚îÇ date   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ txn-001   ‚îÇ 500.0  ‚îÇ Amazon Ind ‚îÇ shopping  ‚îÇDEBIT ‚îÇ Oct 5  ‚îÇ
‚îÇ txn-002   ‚îÇ 1200.0 ‚îÇ Zomato     ‚îÇ food      ‚îÇDEBIT ‚îÇ Oct 6  ‚îÇ
‚îÇ txn-003   ‚îÇ 800.0  ‚îÇ DMart      ‚îÇ grocery   ‚îÇDEBIT ‚îÇ Oct 8  ‚îÇ
‚îÇ txn-004   ‚îÇ 350.0  ‚îÇ Uber       ‚îÇ transport ‚îÇDEBIT ‚îÇ Oct 7  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ User opens Budget tab
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          üìä STEP 5: CATEGORIES FRAGMENT QUERY                   ‚îÇ
‚îÇ  CategoriesFragment.loadCategoryData()                          ‚îÇ
‚îÇ    ‚Ä¢ selectedMonth = October 2025                               ‚îÇ
‚îÇ    ‚Ä¢ startOfMonth = 1696118400000                               ‚îÇ
‚îÇ    ‚Ä¢ endOfMonth = 1698796799999                                 ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  transactionRepository.getCurrentMonthCategorySpending(...)     ‚îÇ
‚îÇ    ‚Üì                                                            ‚îÇ
‚îÇ  SQL Query:                                                     ‚îÇ
‚îÇ  SELECT categoryId, SUM(amount) as totalAmount                  ‚îÇ
‚îÇ  FROM transactions                                              ‚îÇ
‚îÇ  WHERE type = 'DEBIT'                                           ‚îÇ
‚îÇ    AND categoryId IS NOT NULL                                   ‚îÇ
‚îÇ    AND date >= 1696118400000                                    ‚îÇ
‚îÇ    AND date <= 1698796799999                                    ‚îÇ
‚îÇ  GROUP BY categoryId                                            ‚îÇ
‚îÇ  ORDER BY totalAmount DESC                                      ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Result:                                                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ  ‚îÇ categoryId‚îÇ totalAmount ‚îÇ                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                   ‚îÇ
‚îÇ  ‚îÇ food      ‚îÇ 1200.0      ‚îÇ  ‚Üê Zomato                         ‚îÇ
‚îÇ  ‚îÇ grocery   ‚îÇ 800.0       ‚îÇ  ‚Üê DMart                          ‚îÇ
‚îÇ  ‚îÇ shopping  ‚îÇ 500.0       ‚îÇ  ‚Üê Amazon India                   ‚îÇ
‚îÇ  ‚îÇ transport ‚îÇ 350.0       ‚îÇ  ‚Üê Uber                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Returns: List<CategorySpending>                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               üé® STEP 6: UI DISPLAY                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  A. Update Pie Chart:                                           ‚îÇ
‚îÇ     ‚Ä¢ Loop through categorySpending                             ‚îÇ
‚îÇ     ‚Ä¢ Get category name and color from TransactionCategory      ‚îÇ
‚îÇ     ‚Ä¢ Create PieEntry for each                                  ‚îÇ
‚îÇ     ‚Ä¢ Set colors based on category                              ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  B. Update Category List:                                       ‚îÇ
‚îÇ     ‚Ä¢ Submit list to CategorySpendingAdapter                    ‚îÇ
‚îÇ     ‚Ä¢ Adapter binds each item:                                  ‚îÇ
‚îÇ       - Icon (colored circle)                                   ‚îÇ
‚îÇ       - Category name                                           ‚îÇ
‚îÇ       - Amount                                                  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  C. Update Total Spending:                                      ‚îÇ
‚îÇ     ‚Ä¢ Sum all amounts: 1200 + 800 + 500 + 350 = 2850          ‚îÇ
‚îÇ     ‚Ä¢ Display in pie chart center                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Final Display:                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Categories                            Oct'25 ‚ñº         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ          ‚ï±‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï≤                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ        ‚ï±   Spends     ‚ï≤                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ       ‚îÇ    ‚Çπ2,850      ‚îÇ                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ        ‚ï≤             ‚ï±                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ          ‚ï≤‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ï±                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     (Colored slices for each category)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ   [Set monthly budget]                                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  üçî Food & Dining              ‚Çπ1,200                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     1 Spend              Set budget >                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  üõí Grocery                    ‚Çπ800                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     1 Spend              Set budget >                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  üõçÔ∏è Shopping                   ‚Çπ500                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     1 Spend              Set budget >                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  üöó Transportation             ‚Çπ350                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ     1 Spend              Set budget >                  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ **COMPLETE DATA FLOW SUMMARY**

```
SMS Text
    ‚Üì [TransactionSMSReceiver]
Transaction Details (amount, merchant, type)
    ‚Üì [MerchantCategorizer]
Category ID (e.g., "shopping")
    ‚Üì [Transaction object creation]
Database Record (with categoryId)
    ‚Üì [Room Database INSERT]
transactions table row
    ‚Üì [User opens Budget tab]
SQL Query (GROUP BY categoryId, SUM amount)
    ‚Üì [TransactionDao]
List<CategorySpending>
    ‚Üì [CategoriesFragment]
Pie Chart + Category List UI
```

---

## üìä **KEY TABLES & RELATIONSHIPS**

### **TransactionCategory Table:**

```
transaction_categories
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id       ‚îÇ name           ‚îÇ icon ‚îÇ color   ‚îÇ keywords       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ food     ‚îÇ Food & Dining  ‚îÇ üçî   ‚îÇ#FF6B35  ‚îÇ[zomato,swiggy] ‚îÇ
‚îÇ shopping ‚îÇ Shopping       ‚îÇ üõçÔ∏è   ‚îÇ#795548  ‚îÇ[amazon,flipk.] ‚îÇ
‚îÇ grocery  ‚îÇ Grocery        ‚îÇ üõí   ‚îÇ#4CAF50  ‚îÇ[bigbasket,..] ‚îÇ
‚îÇ transport‚îÇ Transportation ‚îÇ üöó   ‚îÇ#2196F3  ‚îÇ[uber,ola,..] ‚îÇ
‚îÇ salary   ‚îÇ Salary & Income‚îÇ üí∞   ‚îÇ#4CAF50  ‚îÇ[salary,credit] ‚îÇ
‚îÇ others   ‚îÇ Others         ‚îÇ üì¶   ‚îÇ#607D8B  ‚îÇ[]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Foreign Key Relationship:**

```
transactions.categoryId ‚Üí transaction_categories.id

If category deleted: SET NULL
If category updated: CASCADE
```

---

## ‚úÖ **VERIFICATION & DEBUGGING**

### **LogCat Tags to Monitor:**

```kotlin
// 1. SMS Reception
"TransactionSMS" ‚Üí "üîî Detected transaction SMS from HDFCBK"

// 2. Extraction
"TransactionCategorizationEngine" ‚Üí "Extracted: ‚Çπ500 at Amazon India"

// 3. Categorization
"MerchantCategorizer" ‚Üí "‚úÖ Match: 'Amazon India' ‚Üí shopping"

// 4. Storage
"SMSManager" ‚Üí "‚úÖ Created transaction: ‚Çπ500 at Amazon India ‚Üí Category: shopping"

// 5. Query
"CategoriesFragment" ‚Üí "üìä Found 4 categories with spending"
"CategoriesFragment" ‚Üí "   üí∞ shopping ('Shopping') ‚Üí ‚Çπ500"

// 6. Display
"CategorySpendingAdapter" ‚Üí "Binding category: shopping, amount: ‚Çπ500"
```

### **Database Verification:**

```sql
-- Check if transaction was inserted
SELECT id, merchant, categoryId, amount 
FROM transactions 
WHERE merchant LIKE '%Amazon%';

-- Check category spending
SELECT categoryId, SUM(amount) as total 
FROM transactions 
WHERE type = 'DEBIT' 
  AND categoryId IS NOT NULL 
GROUP BY categoryId;

-- Verify category exists
SELECT id, name 
FROM transaction_categories 
WHERE id = 'shopping';
```

---

## üéØ **SUMMARY**

### **Complete Journey:**

1. **SMS Arrives** ‚Üí "Rs.500 debited at Amazon India"
2. **Extraction** ‚Üí amount=500, merchant="Amazon India", type=DEBIT
3. **Categorization** ‚Üí MerchantCategorizer ‚Üí "shopping"
4. **Storage** ‚Üí Insert Transaction with categoryId="shopping"
5. **Query** ‚Üí GROUP BY categoryId, SUM(amount)
6. **Display** ‚Üí Pie chart + List showing Shopping: ‚Çπ500

### **Key Points:**

‚úÖ **Automatic** - No manual intervention needed  
‚úÖ **Real-time** - Works even when app closed  
‚úÖ **Accurate** - 400+ keywords for categorization  
‚úÖ **Stored** - All data persisted in Room database  
‚úÖ **Queryable** - Efficient SQL queries with grouping  
‚úÖ **Visual** - Beautiful pie chart and list display  
‚úÖ **Month-wise** - Filter by any month  

**The entire flow from SMS to Categories display is FULLY AUTOMATED and REAL-TIME!** üöÄ

